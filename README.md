# Lua C API Cheat Sheet

### 스택 변화 표기

lua_XXX() 함수가 처리되는 동안, Lua 스택이 어떻게 변화되는 지를 표현한다. 스택에 논리적 인자를 push 하고, lua_XXX() 함수를 호출한다. 그 함수는 논리적 리턴 값을 스택에 넣어두었으므로, caller 코드가 스택에서 값을 뽑아서 확인하는 형태이다. 따라서 각 함수가 스택을 어떻게 변화시키는지를 반드시 확인해서 코딩해야 한다.

`[-o, +p, x]`

 - 첫번째 항목 o 는 스택 최상단에서 몇개의 값이 빠지는가.
   - lua_XXX() 함수는 논리적 인자 o 개를 스택에서 뽑는다.
 - 두번째 항목 p 는 스택 최상단에 몇개의 값이 들어가는가.
   - lua_XXX() 함수는 리턴하기 전에 그 논리적 리턴값 p 개를 스택에 push 한다.
 - 세번째 항목 x 는 에러 발생 여부가 어떻게 되는가.
   - `-` 이면 lua_XXX() 함수는 에러를 발생시키지 않는다.
   - `m` 이면 메모리 부족 에러가 발생할 수 있다.
   - `e` 이면 임의의 모든 에러가 발생할 수 있다.
   - `v` 이면 명시적 목적을 가지고 일부러 에러를 발생할 수 있다.

## 스택 조작

|이름|설명|스택 변화|
|:------|:---|---|
|lua_pushnil(L)|nil 넣기|[-0, +1, -]|
|lua_pushboolean(L, bool)|bool 넣기|[-0, +1, -]|
|lua_pushnumber(L, n)|숫자 넣기|[-0, +1, -]|
|lua_pushinteger(L, n)|숫자 넣기|[-0, +1, -]|
|lua_pushunsigned(L, n)|숫자 넣기|[-0, +1, -]|
|lua_pushstring(L, s)|문자열 넣기|[-0, +1, m]|
|lua_pushlstring(L, s, len)|문자열 넣기|[-0, +1, m]|
|lua_tonumber(L, index)|index 스택 위치에서 숫자 꺼내기|[-0, +0, -]|
|lua_tonumberx(L, index, isnum)|index 스택 위치에서 숫자 꺼내기|[-0, +0, -]|

## 전역 변수 조작

|이름|설명|스택 변화|
|:------|:---|---|
|lua_setglobal(L, name)|스택 최상단에 있는 값을 name 이름의 전역변수로 만들기|[-1, +0, e]|
|lua_getglobal(L, name)|name 이라는 전역변수의 값을 찾아서 스택 최상단에 넣기|[-0, +1, e]|


## Table 조작

|이름|설명|스택 변화|
|:------|:---|---|
|lua_gettable(L, index)|스택 최상단에 임의 타입의 키가 있을때, index 위치의 테이블에서 값 조회. 메타 테이블 있으면 사용됨|[-1, +1, e]|
|lua_getfield(L, index)|스택 최상단에 문자열 키가 있을때, index 위치의 테이블에서 값 조회. 메타 테이블 있으면 사용됨|[-0, +1, e]|
|lua_settable(L, index)|스택 최상단에 값, 그 바로 아래에 임의 타입의 키가 있을 때, index 위치의 테이블에 키와 값을 저장|[-2, +0, e]|
|lua_setfield(L, index)|스택 최상단에 값, 그 바로 아래에 문자열 키가 있을 때, index 위치의 테이블에 키와 값을 저장|[-1, +0, e]|
|lua_rawget(L, index)|스택 최상단에 키가 있을때, index 위치의 테이블에서 값 조회. 메타테이블 무시함|[-1, +1, -]|
|lau_rawgeti(L, index, key)|index 위치의 테이블에서 숫자 key 를 키값 으로 하여 값 조회. 메타테이블 무시함|[-0, +1, -]|


## luaL_ 보조함수

### 인자값 체크

|이름|설명|스택 변화|
|:------|:---|---|
|luaL_checkany(L, arg)|arg 스택 위치에 인자가 nil 포함해서 뭐라도 있는지 체크. 없으면 에러 발생|[-0, +0, v]|
|luaL_checknumber(L, arg)|arg 스택 위치에서 숫자 인자 꺼내기. 숫자 타입이 아니면 에러 발생|[-0, +0, v]|
|luaL_checkstring(L, arg)|arg 스택 위치에서 문자열 꺼내기. 문자열 타입이 아니면 에러 발생|[-0, +0, v]|


# (WIP)
